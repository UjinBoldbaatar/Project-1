import fitz

def get_txt(file_bytes: bytes) -> str:
    """Extracts text from a PDF file (digital or scanned)."""
    text = ""
    with fitz.open(stream=file_bytes, filetype="pdf") as doc:
        for page in doc:
            text += page.get_text() + "\n"
    return text.strip()

from fastapi import UploadFile

async def process_pdf(file: UploadFile):
    contents = await file.read()
    text = extract_text_from_pdf(contents)
    return text

from PIL import Image
import pytesseract
import io

def extract_text_fallback_ocr(page):
    pix = page.get_pixmap(dpi=300)
    img = Image.open(io.BytesIO(pix.tobytes("png")))
    return pytesseract.image_to_string(img)

def get_txt_pdf(file_bytes: bytes) -> str:
    text = ""
    with fitz.open(stream=file_bytes, filetype="pdf") as doc:
        for page in doc:
            page_text = page.get_text()
            if page_text.strip():
                text += page_text + "\n"
            else:
                text += extract_text_fallback_ocr(page)
    return text.strip()
